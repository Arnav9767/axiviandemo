<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registration Form</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#3f51b5" />
    <link rel="icon" href="android-launchericon-192-192.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", sans-serif;
        background: #eaf0f9ec;
        color: #333;
      }

      /* üåê Navbar */
      .navbar {
        /* background: linear-gradient(to right, #1a237e, #03adec); */
        background: #0575e6; /* fallback for old browsers */
        background: -webkit-linear-gradient(
          to right,
          #021b79,
          #0575e6
        ); /* Chrome 10-25, Safari 5.1-6 */
        background: linear-gradient(
          to right,
          #021b79,
          #0575e6
        ); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */

        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 24px;
        flex-wrap: wrap;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .navbar .logo {
        display: flex;
        align-items: center;
      }

      .navbar .logo img {
        height: 65px;
        margin-right: 10px;
        border-radius: 8px;
        /* box-shadow: 0 0 6px rgba(0, 0, 0, 0.2); */
      }

      .navbar .title {
        font-size: 1.9rem;
        font-weight: 800;
        text-align: center;
        flex: 1;
        font-family: "Segoe UI", sans-serif;
      }

      @keyframes floatIcon {
        0% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-6px);
        }
        100% {
          transform: translateY(0px);
        }
      }

      .install-btn {
        position: fixed;
        bottom: 60px;
        right: 20px;
        background: #e67514;
        border: none;
        color: white;
        padding: 10px 14px;
        font-size: 18px;
        border-radius: 50%;
        cursor: pointer;
        transition: background 1s ease;
        z-index: 9999;
      }

      .install-btn:hover {
        background: #ffffff44;
      }

      .floating-icon {
        animation: floatIcon 0.5s ease-in-out infinite;
      }

      .adminBtn {
        background: #e67514;
        border: none;
        color: white;
        padding: 10px 14px;
        font-size: 18px;
        border-radius: 50%;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      .adminBtn:hover {
        background: #ffffff44;
      }

      /* Responsive tweaks */
      @media (max-width: 600px) {
        .navbar {
          flex-direction: column;
          text-align: center;
          gap: 10px;
        }

        .navbar .title {
          margin-top: 10px;
        }

        .navbar .install-btn {
          border-radius: 30px;
          padding: 8px 16px;
          font-size: 14px;
        }
      }

      /* üßæ Form */
      .form-container {
        background: white;
        max-width: 500px;
        margin: 40px auto;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 22px rgba(0, 0, 0, 0.4);
      }

      .form-container h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #3f51b5;
      }

      .form-container input {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 14px;
      }

      .form-container button {
        width: 100%;
        background: linear-gradient(to right, #2196f3, #0d47a1);
        color: white;
        border: none;
        padding: 14px;
        font-size: 16px;
        border-radius: 30px;
        cursor: pointer;
        margin-top: 10px;
      }

      .form-container button:hover {
        background: linear-gradient(to right, #0d47a1, #2196f3);
      }

      label {
        display: block;
        margin-top: 15px;
        font-weight: 500;
        color: #444;
      }

      .toast {
        display: none;
        margin-top: 20px;
        padding: 14px;
        background-color: #4caf50;
        color: white;
        text-align: center;
        border-radius: 8px;
        font-size: 15px;
        animation: fadeInOut 3s ease-in-out;
      }

      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translateY(10px);
        }

        10% {
          opacity: 1;
          transform: translateY(0);
        }

        90% {
          opacity: 1;
          transform: translateY(0);
        }

        100% {
          opacity: 0;
          transform: translateY(-10px);
        }
      }

      @media (max-width: 600px) {
        .navbar {
          flex-direction: column;
          text-align: center;
        }

        .navbar .title {
          margin: 10px 0;
        }
        .form-container {
          margin: 0;
        }
      }

      /* üîò Styled Radio Buttons */
      .radio-group {
        display: flex;
        gap: 30px;
        align-items: center;
        margin: 10px 0 20px 0;
      }

      .radio-option {
        display: flex;
        align-items: center;
        font-size: 15px;
        color: #333;
      }

      .radio-option input[type="radio"] {
        margin-right: 8px;
        accent-color: #3f51b5;
        transform: scale(1.3);
        cursor: pointer;
      }

      @media (max-width: 600px) {
        .radio-group {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }
      }

      /* Fullscreen overlay */
      /* üî≤ Fullscreen overlay for loader */
      .loader-overlay {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 100vw;
        background: rgba(255, 255, 255, 0.8);
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* üîÑ Animated triangle illusion loader */
      .loader {
        width: 60px;
        aspect-ratio: 1.154; /* Perfect triangle ratio */
        --c: #0000, #ef8025 2deg 59deg, #0000 61deg;
        --c1: conic-gradient(from 149deg at top, var(--c));
        --c2: conic-gradient(from -31deg at bottom, var(--c));
        background: var(--c1) top, var(--c1) bottom right, var(--c2) bottom,
          var(--c1) bottom left;
        background-size: 50% 50%;
        background-repeat: no-repeat;
        animation: l37 1s infinite;
      }

      @keyframes l37 {
        80%,
        100% {
          background-position: bottom right, bottom left, bottom, top;
        }
      }
    </style>
  </head>

  <body>
    <!-- üöÄ Navbar -->
    <div class="navbar">
      <div class="logo">
        <img src="./logo/logo.png" alt="Logo" />
      </div>
      <div class="title">‡§ú‡§®‡§ï‡§≤‡•ç‡§Ø‡§æ‡§£ ‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø ‡§∏‡•á‡§µ‡§æ</div>
      <div style="display: flex; gap: 10px; align-items: center">
        <button
          id="adminBtn"
          class="adminBtn"
          style="border-radius: 30px; padding: 8px 10px; display: block"
          onclick="window.location.href='login.html'"
          title="Go to Admin Panel"
        >
          <i class="fas fa-user-shield"></i> Admin
        </button>

        <button
          id="installBtn"
          class="install-btn"
          style="display: none"
          title="Install App"
        >
          <i class="fas fa-download floating-icon"></i>
        </button>
      </div>
    </div>

    <!-- üìù Registration Form -->
    <div class="form-container">
      <h2>Registration Form</h2>
      <form id="regForm">
        <label><i class="fa-solid fa-circle-user"></i> Name</label>
        <input type="text" name="name" placeholder="Enter Full Name" required />

        <label><i class="fa-solid fa-file"></i> File No</label>
        <input
          type="text"
          name="fileno"
          placeholder="Enter File Name"
          required
        />

        <label><i class="fa-solid fa-location-dot"></i> Address</label>
        <input
          type="text"
          name="address"
          placeholder="Enter Permanent Address"
          required
        />

        <label><i class="fa-solid fa-address-card"></i> Aadhar No.</label>
        <input
          type="text"
          name="aadhar"
          id="aadhar"
          placeholder="Enter Aadhar No."
          required
          pattern="\d{12}"
          maxlength="12"
          oninput="this.value = this.value.replace(/[^0-9]/g, '')"
        />

        <label><i class="fa-solid fa-phone-volume"></i> Mobile No.</label>
        <input
          type="text"
          name="mobile"
          id="mobile"
          placeholder="Enter Mobile No."
          required
          pattern="\d{10}"
          maxlength="10"
          oninput="this.value = this.value.replace(/[^0-9]/g, '')"
        />

        <label><i class="fa-solid fa-user-plus"></i> Age</label>
        <input type="number" name="age" placeholder="Enter Age" required />

        <label><i class="fa-solid fa-briefcase"></i> Occupation</label>
        <input
          type="text"
          name="occupation"
          placeholder="Enter Occupation"
          required
        />

        <label><i class="fa-solid fa-receipt"></i> Receipt</label>
        <input
          type="text"
          name="receipt"
          placeholder="Enter Receipt No."
          required
        />

        <label><i class="fa-solid fa-id-badge"></i> Referral ID</label>
        <input type="text" name="referral" placeholder="eg.Abhi9119" required />
        <label><i class="fa-solid fa-money-bill"></i> Payment Mode</label>
        <div class="radio-group">
          <label class="radio-option">
            <input
              type="radio"
              name="paymentMode"
              value="cash"
              onchange="toggleQRCode(false)"
            />
            Cash
          </label>
          <label class="radio-option">
            <input
              type="radio"
              name="paymentMode"
              value="online"
              checked
              onchange="toggleQRCode(true)"
            />
            Online
          </label>
          ¬†¬†¬†¬†¬†¬†
        </div>
        <div id="qrCodeField">
          <label><i class="fa-solid fa-qrcode"></i> QR Code</label><br />
          <img
            src="./logo/qr.jpeg"
            alt="Scan QR Code"
            style="width: 200px; height: auto"
          />
          ¬†¬†¬†¬†¬†¬†
        </div>

        <button type="submit">Submit</button>
      </form>

      <!-- ‚úÖ Success Notification -->
      <div id="toast" class="toast">‚úÖ Successfully Registered!</div>
    </div>
    <div id="loader" class="loader-overlay" style="display: none">
      <div class="loader"></div>
    </div>
  </body>

  <script>
    document
      .getElementById("regForm")
      .addEventListener("submit", async function (e) {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        // Store form values in object for localStorage (used in all branches)
        const formValues = {
          name: form.name.value,
          fileNo: form.fileno.value,
          address: form.address.value,
          aadhar: form.aadhar.value,
          mobile: form.mobile.value,
          age: form.age.value,
          occupation: form.occupation.value,
          receipt: form.receipt.value,
          referral: form.referral.value,
          paymentMode: form.paymentMode.value,
        };
        document.getElementById("loader").style.display = "flex";

        try {
          const response = await fetch(
            "https://script.google.com/macros/s/AKfycbwlJ6o67eylK5LbmEvDbP4Wv7z5Ue7ZOFVrK4-4-vETySKPPlRemcBdTKONtosrkw0M/exec",
            {
              method: "POST",
              body: formData,
            }
          );
          const result = await response.json();

          if (result.status === "success") {
            const message = `Hi ${formValues.name}, your registration was successful! ‚úÖ ‡§ú‡§®‡§ï‡§≤‡•ç‡§Ø‡§æ‡§£ ‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø ‡§∏‡•á‡§µ‡§æ ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ü‡§™‡§≤‡•á ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á! Your Referral ID: ${formValues.referral}`;

            // ‚úÖ Send SMS
            await fetch("http://localhost:3000/send-sms", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ number: formValues.mobile, message }),
            });

            // ‚úÖ Save to localStorage
            localStorage.setItem("userDetail", JSON.stringify(formValues));

            // ‚úÖ Show Toast and Redirect
            const toast = document.getElementById("toast");
            toast.style.display = "block";

            setTimeout(() => {
              toast.style.display = "none";
              window.location.href = "userdetail.html";
            }, 2000);
          } else {
            // ‚ùå Failure from backend
            alert("‚ùå Something went wrong: " + result.message);

            // Save to localStorage and redirect anyway
            localStorage.setItem("userDetail", JSON.stringify(formValues));
            window.location.href = "userdetail.html";
          }
        } catch (error) {
          // ‚ùå Network/JS error
          alert("‚ùå Error submitting form: " + error.message);

          // Save to localStorage and redirect anyway
          localStorage.setItem("userDetail", JSON.stringify(formValues));
          window.location.href = "userdetail.html";
        } finally {
          document.getElementById("loader").style.display = "none"; // ‚úÖ Always hide loader
        }
      });

    // üì≤ PWA Install Button
    let deferredPrompt;
    const installBtn = document.getElementById("installBtn");

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = "block";
    });

    installBtn.addEventListener("click", async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === "accepted") {
          console.log("‚úÖ App installed");
          installBtn.style.display = "none";
        } else {
          console.log("‚ùå App install declined");
        }
        deferredPrompt = null;
      }
    });

    // üîÅ QR Code Toggle
    function toggleQRCode(show) {
      const qrCodeField = document.getElementById("qrCodeField");
      const qrInput = qrCodeField.querySelector("input");

      if (show) {
        qrCodeField.style.display = "block";
        if (qrInput) qrInput.setAttribute("required", "true");
      } else {
        qrCodeField.style.display = "none";
        if (qrInput) {
          qrInput.removeAttribute("required");
          qrInput.value = "";
        }
      }
    }
  </script>

  <!-- <script>

          document
            .getElementById("regForm")
            .addEventListener("submit", async function (e) {
              e.preventDefault();

              const form = e.target;
              const formData = new FormData(form); // Using FormData to avoid CORS preflight

              try {
                const response = await fetch(
                  "https://script.google.com/macros/s/AKfycbwZ2lGpDiGdeBwz4I43oEl4jfZN21b0hhZ3Z39-ztgsq-dQRuusgxUS1KoEvwlK-NPY/exec",
                  {
                    method: "POST",
                    body: formData,
                  }
                );

                const result = await response.json();
                if (result.status === "success") {
                  alert("Registration successful! SMS sent.");
                  form.reset();
                } else {
                  alert("Something went wrong: " + result.message);
                }
              } catch (error) {
                alert("Error submitting form: " + error.message);
              }
            });
          function sendSMS(number, message) {
            const apiKey =
              "HJi8wSaCrPVSMYLmNHvKnOFDAr17nUA2u59bmRzNnuaoAyRnQcUHGPruUFXp"; // Replace with your API key
            const senderId = "FSTSMS"; // Or your registered sender ID (optional in test mode)

            const payload = {
              sender_id: senderId,
              message: message,
              language: "english",
              route: "p", // 'p' = promotional, 't' = transactional
              numbers: number,
            };

            const options = {
              method: "post",
              contentType: "application/json",
              headers: {
                authorization: apiKey,
              },
              payload: JSON.stringify(payload),
            };

            UrlFetchApp.fetch("https://www.fast2sms.com/dev/bulkV2", options);
          }
        </script> -->
  <!-- </body>
    </html> -->
</html>
